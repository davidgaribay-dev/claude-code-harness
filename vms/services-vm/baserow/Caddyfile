{
    # Disable automatic HTTPS - external Caddy handles SSL
    auto_https off
}

:80 {
    handle /api/* {
        reverse_proxy backend:8000
    }

    handle /ws/* {
        reverse_proxy backend:8000
    }

    handle /mcp/* {
        reverse_proxy backend:8000
    }

    handle /assistant/* {
        reverse_proxy backend:8000
    }

    handle_path /media/* {
        @downloads {
            query dl=*
        }
        header @downloads Content-disposition "attachment; filename={query.dl}"

        header {
            Access-Control-Allow-Origin *
            Access-Control-Allow-Methods "GET, HEAD, OPTIONS"
            Access-Control-Allow-Headers "*"
            Access-Control-Expose-Headers "Content-Length, Content-Type"
        }

        file_server {
            root /baserow/media/
        }
    }

    handle_path /static/* {
        file_server {
            root /baserow/static/
        }
    }

    reverse_proxy web-frontend:3000
}
