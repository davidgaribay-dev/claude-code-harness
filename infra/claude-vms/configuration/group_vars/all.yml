---
# OS Hardening Configuration (devsec.hardening.os_hardening)

# Sysctl settings - enable IP forwarding for Docker
sysctl_overwrite:
  net.ipv4.ip_forward: 1
  net.ipv6.conf.all.forwarding: 1

# Allow specific kernel modules needed for Docker/containers
os_hardening_allowed_kernel_modules:
  - overlay
  - br_netfilter

# Users allowed to use cron
os_hardening_allowed_cron_users:
  - root
  - "{{ dev_user }}"

# Don't disable kernel module loading (needed for Docker)
os_security_kernel_module_loading: true

# Password policy - relaxed for dev environment
os_auth_pw_max_age: 99999
os_auth_pw_min_age: 0

# Development Environment Settings

# User for development (can be overridden via -e cloud_init_user=xxx)
dev_user: "{{ cloud_init_user | default('dmg') }}"
dev_user_home: "/home/{{ dev_user }}"

# Git configuration
git_user_email: "me@davidgaribay.dev"
git_user_name: "David Garibay"

# GitHub CLI token (optional - set via environment variable for security)
# export ANSIBLE_GH_TOKEN="ghp_xxxx" then pass with -e "gh_token=$ANSIBLE_GH_TOKEN"
gh_token: ""

# Claude Code credentials file (path to local .credentials.json)
claude_credentials_file: "~/.claude/.credentials.json"

# NVM version
nvm_version: "v0.40.3"

# tea CLI version (Gitea CLI) - optional, disabled by default
# Enable with: -e "install_gitea_tea=true"
install_gitea_tea: false
tea_version: "0.11.1"

# Packages to install
dev_packages:
  - git
  - curl
  - wget
  - vim
  - htop
  - tmux
  - jq
  - unzip
  - ca-certificates
  - gnupg
  - lsb-release
  - apt-transport-https
  - software-properties-common
  - build-essential
  - bubblewrap  # Required for Claude Code sandbox mode on Linux

# Go configuration (geerlingguy.go role)
# Uses official tarball from go.dev (not apt's outdated package)
go_version: "1.25.6"

# Docker configuration (geerlingguy.docker role)
docker_users:
  - "{{ dev_user }}"
docker_install_compose_plugin: true
docker_compose_package: docker-compose-plugin
docker_compose_package_state: present

# Neo4j MCP Configuration
# neo4j_ip is passed from the orchestration script via -e flag
neo4j_ip: "{{ lookup('env', 'NEO4J_IP') | default('10.0.70.50', true) }}"
neo4j_uri: "bolt://{{ neo4j_ip }}:7687"
neo4j_username: "neo4j"
neo4j_password: "{{ lookup('env', 'NEO4J_PASSWORD') | default('changeme', true) }}"

# Core Services Configuration (Plane + Rewind)
# core_services_ip is passed from the orchestration script via -e flag
core_services_ip: "{{ lookup('env', 'CORE_SERVICES_IP') | default('10.0.70.70', true) }}"
core_services_ssh_user: "{{ lookup('env', 'CORE_SERVICES_SSH_USER') | default('dmg', true) }}"

# Plane MCP Configuration
# HTTPS works because Caddy's root CA is installed in the VM's trust store
plane_api_url: "https://{{ core_services_ip }}"
plane_workspace_slug: "{{ lookup('env', 'PLANE_WORKSPACE_SLUG') | default('', true) }}"
plane_api_key: "{{ lookup('env', 'PLANE_API_KEY') | default('', true) }}"

# Rewind Configuration
# Use the web external port (8444) which proxies /api to the API container
# This avoids cross-origin issues with self-signed certs on separate ports
rewind_web_port: 8444  # External HTTPS port for web (Caddy) - also serves /api
rewind_api_url: "https://{{ core_services_ip }}:{{ rewind_web_port }}"
